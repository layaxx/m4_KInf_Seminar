const fs = require("fs")
const readline = require("readline")

const data = new Map()

async function processLineByLine() {
  const fileStream = fs.createReadStream("paper_date_refs.csv")

  const rl = readline.createInterface({
    input: fileStream,
    crlfDelay: Infinity,
  })
  // Note: we use the crlfDelay option to recognize all instances of CR LF
  // ('\r\n') in input.txt as a single line break.

  for await (const line of rl) {
    // skip first line
    if (line.startsWith("paper_id,")) continue

    const [_paperId, date, _refId] = line.split(",")
    const year = date.split("-")[0]
    if (data.has(year)) {
      data.set(year, data.get(year) + 1)
    } else {
      data.set(year, 1)
    }
  }

  console.log(data)
}

processLineByLine()

/* Result:

{
  '1984' => 1391129,
  '2006' => 5761534,
  '1965' => 564399,
  '1924' => 77349,
  '1957' => 317670,
  '1956' => 301472,
  '1963' => 475994,
  '1980' => 1237627,
  '2010' => 8044588,
  '2002' => 4039378,
  '2009' => 7409952,
  '1941' => 103550,
  '1978' => 1075087,
  '1930' => 109805,
  '2003' => 4390468,
  '1904' => 45688,
  '1901' => 40991,
  '1860' => 11499,
  '1911' => 59183,
  '1898' => 37460,
  '1914' => 60468,
  '1897' => 35348,
  '1870' => 14647,
  '1890' => 27832,
  '1902' => 42038,
  '1883' => 23629,
  '1919' => 52394,
  '1918' => 49297,
  '1861' => 10039,
  '1912' => 64841,
  '1916' => 51852,
  '1915' => 52794,
  '1910' => 60349,
  '1909' => 54748,
  '1889' => 26974,
  '1877' => 17463,
  '1913' => 64004,
  '1851' => 9259,
  '1887' => 28016,
  '1899' => 42043,
  '1908' => 52144,
  '1903' => 44045,
  '1905' => 47569,
  '1882' => 21199,
  '1802' => 1874,
  '1920' => 60857,
  '1873' => 15815,
  '1800' => 6354,
  '1880' => 23707,
  '1893' => 30501,
  '1894' => 31858,
  '1906' => 49247,
  '1896' => 34563,
  '1834' => 4093,
  '1866' => 11761,
  '1878' => 18793,
  '1821' => 2453,
  '1900' => 72611,
  '1844' => 6214,
  '1820' => 2335,
  '1836' => 4689,
  '1875' => 17643,
  '1885' => 25026,
  '1891' => 27758,
  '1858' => 11480,
  '1864' => 11377,
  '1907' => 48693,
  '1853' => 9263,
  '1867' => 11745,
  '1818' => 1973,
  '1895' => 34019,
  '1832' => 3381,
  '1917' => 50076,
  '1842' => 6248,
  '1806' => 1808,
  '1892' => 28350,
  '1837' => 5095,
  '1856' => 9889,
  '1854' => 9329,
  '1862' => 11123,
  '1874' => 15702,
  '1881' => 21177,
  '1855' => 10177,
  '1859' => 11032,
  '1888' => 27844,
  '1868' => 12070,
  '1857' => 12425,
  '1886' => 26580,
  '1884' => 24476,
  '1848' => 7275,
  '1869' => 12733,
  '1804' => 1791,
  '1876' => 16716,
  '1845' => 6408,
  '1839' => 4986,
  '1852' => 8461,
  '1863' => 11867,
  '1865' => 11085,
  '1879' => 19435,
  '1872' => 14880,
  '1801' => 2365,
  '1871' => 12574,
  '1831' => 3353,
  '1823' => 2295,
  '1815' => 2872,
  '1849' => 6902,
  '1822' => 2419,
  '1824' => 2544,
  '1847' => 6169,
  '1813' => 1799,
  '1840' => 5935,
  '1843' => 6302,
  '1814' => 1756,
  '1841' => 5478,
  '1838' => 4581,
  '1809' => 1794,
  '1803' => 1796,
  '1808' => 1726,
  '1807' => 1447,
  '1828' => 3321,
  '1846' => 6843,
  '1825' => 2622,
  '1833' => 3530,
  '1830' => 4296,
  '1829' => 3378,
  '1850' => 9035,
  '1810' => 1752,
  '1827' => 3242,
  '1811' => 1833,
  '1812' => 1892,
  '1826' => 2686,
  '1835' => 4615,
  '1816' => 1968,
  '1805' => 1551,
  '1817' => 1886,
  '1819' => 1867,
  '1943' => 91298,
  '1999' => 3091196,
  '1950' => 242333,
  '1975' => 962033,
  '1974' => 916019,
  '2018' => 9004044,
  '1966' => 598667,
  '1927' => 93393,
  '1942' => 98529,
  '1993' => 2177431,
  '1983' => 1321335,
  '2000' => 3469248,
  '1970' => 870121,
  '1967' => 647120,
  '1986' => 1531537,
  '1958' => 337751,
  '1969' => 744879,
  '2008' => 6824708,
  '1989' => 1801878,
  '1988' => 1693931,
  '2015' => 9604468,
  '1954' => 281974,
  '1985' => 1453708,
  '1972' => 849686,
  '1962' => 437345,
  '1951' => 247832,
  '2019' => 9234926,
  '1977' => 1031819,
  '1946' => 120346,
  '1940' => 136790,
  '2005' => 5246023,
  '1935' => 114049,
  '1922' => 70553,
  '1959' => 359944,
  '1947' => 146150,
  '1976' => 986131,
  '1953' => 270845,
  '1933' => 108407,
  '1925' => 81879,
  '1990' => 1969612,
  '2012' => 8826720,
  '1952' => 260092,
  '1936' => 115906,
  '1997' => 2769866,
  '2004' => 4811311,
  '1928' => 96854,
  '1994' => 2301875,
  '1982' => 1259568,
  '1945' => 92422,
  '1991' => 1985416,
  '1992' => 2072558,
  '1934' => 107859,
  '2013' => 9255541,
  '1987' => 1616848,
  '1926' => 89167,
  '1979' => 1120831,
  '1948' => 168545,
  '1944' => 83884,
  '1929' => 100009,
  '1998' => 2945022,
  '1971' => 812340,
  '1996' => 2612053,
  '1968' => 695838,
  '1931' => 105263,
  '1955' => 292740,
  '1981' => 1229858,
  '1938' => 118299,
  '2017' => 9222019,
  '2001' => 3692385,
  '1923' => 72595,
  '1949' => 183228,
  '1921' => 62898,
  '1937' => 115100,
  '2014' => 9548086,
  '2011' => 8501404,
  '1960' => 414603,
  '1961' => 408405,
  '1964' => 511914,
  '1973' => 878454,
  '2016' => 9771015,
  '1995' => 2426109,
  '2020' => 8715071,
  '1939' => 118870,
  '2007' => 6192490,
  '1932' => 107187
}
*/
